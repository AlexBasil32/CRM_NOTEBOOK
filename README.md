# Дипломная работа "Система управления контактными данными клиентов".
# Александров В.С

В курсе "Профессия "Фронтенд разработчик с нуля", образовательной платформы Skillbox.ru

>Backend-часть проекта находится в папке репозитория "crm-backend"


## Техническое задание

### Разработать web-интерфейс для CRM системы, в которой должны быть следующие возможности:
* Просмотр списка людей в виде таблицы
* Добавление нового клиента
* Изменение информации о существующем клиенте

### Каждый контакт представляет из себя следующий набор данных:
* Имя
* Фамилия
* Отчество
* Массив объектов с контактными данными, где каждый объект содержит:
  - Тип контакта (телефон, email, VK и т.п.)
  - Значение контакта (номер телефона, адрес email, ссылка на страницу в VK и т.п.)

Интерфейс представляет из себя единственную страницу, на которой располагается таблица клиентов, кнопка для добавления нового клиента, а также шапка с логотипом компании и строкой поиска клиентов.

<br/>

### Описание экранов приложения
#### Таблица со списком клиентов

##### Таблица со списком людей имеет следующие колонки:
* ID
* ФИО (Фамилия Имя Отчество через пробел)
* Дата и время создания
* Дата и время последнего изменения
* Контакты
* Действия (кнопки)
  - Изменить клиента
  - Удалить клиента

Таблица должна строиться на основе данных из API. При первичной загрузке нужно отображать индикатор загрузки, пока таблица с данными не будет построена.

##### Сортировка
Все заголовки колонок, кроме контактов и действий, можно нажать, чтобы установить сортировку по соответствующему полю. Первое нажатие устанавливает сортировку по возрастанию, повторное - по убыванию.

Сортировка должна происходить из JavaScript, то есть API передаёт данные в неотсортированном виде.

##### Поиск
При вводе текста в поле для поиска данные для таблицы должны быть
перезапрошены из API с введённым поисковым запросом. При этом запрос должен отправляться только по прошествии 300мс с момента последнего ввода символа в поле (то есть нужно ожидать, пока пользователь не завершит ввод поискового запроса).

##### Отображение контактов клиента
В колонке с контактами для контактов VK, Facebook, телефона и email должны отображаться соответствующие иконки. Все остальные виды контактов отображаются с одинаковыми иконками с человечком.

При наведении указателя на контакт должна показываться
всплывающая подсказка с типом и значением этого контакта в
формате "**Тип**: значение" (Например: "**Email**: abc@abc.ru",
"**Телефон**: +71234567890", "**Twitter**: @xyz").

#### Действия над клиентами
При нажатии на кнопку "Изменить" должно появиться модальное окно с формой изменения клиента. Подробное описание поведения формы приведено ниже.

При нажатии на кнопку "Удалить" должно появиться модальное окно с подтверждением
действия. Если пользователь подтверждает удаление, то человек должен быть удалён
из списка. Также на сервер с API должен посылаться запрос на удаление.

#### Формы создания или редактирования данных о клиентах
Форма создания клиента должна открываться в виде модального окна по нажатию на кнопку "Добавить клиента", находящуюся под таблицей. Форма редактирования клиента должна открываться по нажатию на кнопку "Изменить" в таблице клиентов.

Форма создания клиента открывается сразу с незаполненными полями.

При изменении клиента перед открытием формы из API должны быть запрошены свежие данные клиента, только после получения этих данных должна открыться форма. При этом форма должна быть заполнена соответствующими данными клиента.

#### Контакты клиента
В блоке контактов нужно предусмотреть возможность добавления до 10 контактов включительно. Для этого под добавленными контактами должна быть кнопка "Добавить контакт". Если у клиента уже добавлено 10 контактов, кнопка не должна отображаться.

Каждый контакт можно удалить из списка по нажатию на крестик справа от него.

#### Кнопки
Под формой должна располагаться кнопка "Сохранить". Кнопка "Удалить клиента" добавляется, если это форма редактирования существующего в базе данных человека.

По нажатию на кнопку удаления клиент должен быть удалён из таблицы, а на сервер API должен быть отправлен запрос на удаление клиента. Модальное окно с формой должно закрыться/

По нажатию на кнопку сохранения изменения должны быть отправлены на сервер с использованием метода создания или изменения существующего клиента. Далее в зависимости от ответа сервера:
* Если сохранение прошло успешно (статус ответа 200 или 201), модальное окно с формой закрывается. При этом таблица должна быть отрисована заново с новым запросом на список людей.
* Если при сохранении произошла ошибка (статус ответа 422, 404 или 5xx), то нужно отобразить сообщения об ошибках, полученные в ответе
сервера, над блоком с кнопками. При этом если ответ сервера не удалось разобрать или в нём нет сообщений об ошибке, нужно отобразить сообщение по умолчанию "Что-то пошло не так...".


По нажатию на кнопку с крестиком, кнопку отмены или фон модального окна модальное окно должно закрыться.

<br/>

## Инструкция по использованию инфраструктуры
Дизайн доступен в виде макета в Figma

<br/>

## Технические требования
Выполненную работу необходимо предоставить в виде отдельного репозитория. Репозиторий должен включать в себя страницу в качестве точки входа в приложения.

<br/>

## Улучшения и дополнения
>Эти задачи не являлись обязательными, но они все реализованы.

1. Анимация открытия модального окна.
2. Ссылка на карточку клиента.
3. Валидация формы перед отправкой на сервер.
    1. Имя и фамилия обязательны для заполнения.
    2. Каждый добавленный контакт должен быть полностью заполнен.

При неуспешной проверке нужно добавить над кнопкой соответствующие сообщения об ошибках, а также подсветить ошибочные поля в соответствии с макетом. Отправка ошибочных данных на сервер происходить не должна.

4. Индикация загрузки.
Индикация загрузки нужна для 3-х случаев:
  * Загрузка таблицы со списком клиентов при открытии страницы, после ввода значения в поле для поиска и т.п.
  * Загрузка данных клиента при открытии формы редактирования.
  * Отправка формы создания или редактирования клиента.
5. Поиск с автодополнением. Найденный контакт должен быть подсвечен в таблице и, при необходимости, прокрутить страницу до выделенного контакта. Сами элементы получать из API списка элементов, а в каждой строке показывать "Имя Фамилия" найденного контакта. Очень важно - добавить возможность выбора с помощью клавиш стрелок вверх/вниз и Enter на клавиатуре.

<br/>

## Критерии оценки
* Соответствие разработанного интерфейса требованиям в техническом задании.
* Понятность написанного кода. Сюда же можно отнести корректное
именование переменных, констант и функций, которое должно
соответствовать тому, что в них содержится.
* Единый стиль написания кода, в том числе:
  - нет смешанного именования (camelCase, snake_case);
  - везде используются одинаковые отступы (2 пробела, 4 пробела
или 1 табуляция);
  - единый стиль объявления функций (function declaration или
function expression);
  - единый стиль работы с массивами (цикл for of или метод forEach).
* Правильность использования элементов HTML.
* Правильность использования CSS стилей.
* Уместность использования средств языка JavaScript. Сюда могут
относиться следующие обязательные моменты (но не только они):
  - для переменных используется let;
  - для констант const;
  - предпочтение отдаётся const всегда, когда это возможно;
  - изоляция области видимости;

**И рекомендации:**
* дублирующиеся участки кода вынесены в функции;
* правильное использование методов массива (forEach, filter, find, reduce);
* осознанная работа с объектами как со ссылочным типом;
* разделение логики и представления (это значит, что в работе вы должны отделять отрисовку интерфейса и работу с сервером).




# REST API для базы данных клиентов

Перед запуском убедитесь, что вы установили Node.js версии 12 или выше.

Для запуска сервера перейдите в папку с репозиторием и выполните команду `node index`. Для остановки нажмите сочетание клавиш CTRL+C.

После запуска сервера API будет доступен по пути `http://localhost:3000`.

## Методы API

Все методы API, требующие тела запроса, ожидают получить тело в виде JSON. Ответы всех методов также отдаются в виде JSON.

* `GET /api/clients` получить список клиентов. Параметры, передаваемые в URL:
    * `search={search string}` поисковый запрос, при передаче метод вернёт клиентов, у которых имя, фамилия, отчество или значение одного из контактов содержат указанную подстроку
* `POST /api/clients` создать нового клиента. В теле запроса нужно передать объект клиента. Тело ответа успешно обработанного запроса будет содержать объект с созданным клиентом.
* `GET /api/client/{id}` получить данные клиента по его ID. Тело ответа успешно обработанного запроса будет содержать объект клиента.
* `PATCH /api/client/{id}` перезаписать данные о клиенте с переданным ID. Тело ответа успешно обработанного запроса будет содержать объект с обновлённым клиентом.
* `DELETE /api/client/{id}` удалить клиента с переданному ID.

## Структура объекта клиента

```javascript
{
  // ID клиента, заполняется сервером автоматически, после создания нельзя изменить
  id: '1234567890',
  // дата и время создания клиента, заполняется сервером автоматически, после создания нельзя изменить
  createdAt: '2021-02-03T13:07:29.554Z',
  // дата и время изменения клиента, заполняется сервером автоматически при изменении клиента
  updatedAt: '2021-02-03T13:07:29.554Z',
  // * обязательное поле, имя клиента
  name: 'Василий',
  // * обязательное поле, фамилия клиента
  surname: 'Пупкин',
  // необязательное поле, отчество клиента
  lastName: 'Васильевич',
  // контакты - необязательное поле, массив контактов
  // каждый объект в массиве (если он передан) должен содержать непустые свойства type и value
  contacts: [
    {
      type: 'Телефон',
      value: '+79159824762'
    },
    {
      type: 'Email',
      value: 'touchmebb89@gmail.com'
    },
    {
      type: 'Facebook',
      value: 'https://facebook.com/vasiliy-pupkin-the-best'
    }
  ]
}
```

## Возможные статусы ответов

Ответ сервера может содержать один из статусов ответа:
* `200` - запрос обработан нормально
* `201` - запрос на создание нового элемента успешно обработан, а заголовок ответа Location содержит ссылку на GET метод получения созданного элемента
* `404` - переданный в запросе метод не существует или запрашиваемый элемент не найден в базе данных
* `422` - объект, переданный в теле запроса, не прошёл валидацию. Тело ответа содержит массив с описаниями ошибок валидации:
  ```javascript
  [
    {
      field: 'Название поля объекта, в котором произошла ошибка',
      message: 'Сообщение об ошибке, которое можно показать пользователю'
    }
  ]
  ```
* `500` - странно, но сервер сломался <br>Обратитесь к куратору Skillbox, чтобы решить проблему
